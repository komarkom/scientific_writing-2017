# Программа создания кода управления фрезеровочным станком по трехмерной модели.

## Аннотация 
В статье ставится задача написать программу, которая позволит повысить качество изготавливаемой детали и сократит время ее изготовления. Подход к решению задачи заключается в расслоении модели на вертикальные и горизонтальные слои, что позволит повысить качество выполнения детали, так как если выточить деталь используя только горизонтальные срезы, плоскости будут состоять из ступеней.  Это допустимо для детали грубой обработки, но никак не в качестве конечного результата. Слои будут состоять из фигур произвольной формы. Далее полученные произвольной формы фигуры будут преобразованы в контуры с последующим фрезерованием поверхности внутри них. Контуры планируется представлять в виде набора линий и кривых Безье.

## Введение
На текущий момент есть ряд программ, которые строят код посредством кусочно-линейной аппроксимации и неправильной траектории, которая не редко приводит к порче оборудования. Кусочно-линейная траектория значительно увеличивает код, что в свою очередь приводит к потере времени. Программа, которая будет также использовать круговую интерполяцию, существенно сократит код, что позволит повысить качество детали, а также сократит время ее изготовления. Написать программу построения G-code используя результаты работы предыдущей научно исследовательской работы, направленные на разработку оптимального маршрута движения фрезы.
1.	Научиться делить модель на слои
2.	Строить траекторию движения фрезы при помощи кусочно-линейной и круговой интерполяции.
В качестве объекта исследований служили программы, выполняющие построение G-code.
В качестве объекта исследований выступал процесс фрезерования.

## Сравнение аналогов 
### Intuwiz G-code Generator
Используя Intuwiz G-code Generator можно автоматически создавать управляющие программы для систем числового программного управления, обеспечивающие работу станочного оборудования при выполнении определенных фрезерных работ, гравирования, сверления отверстий и групп отверстий. 
### Генерация G-кода, из текста, рисунка, и файлов PLT, DXF 
Программа позволяет генерировать G-код, для фрезерных, лазерных, гравировальных станков, с учетом их особенностей, согласно правилам синтаксиса. Программа находится в процессе разработки, и конечно содержит не мало ошибок, но я её решил выложить, что-бы ещё на стадии разработки, совместно с пользователями сделать максимально простой, и интуитивно понятной.
### Gcodetools - CAM расширение для Incscape
Gcodetools это расширение векторного редактора Inkscape, которое позволяет подготавливать и экспортировать векторную графику в Gкод.
Gcodetools и Inkscape распространяются под лицензией GNU GPL, т.е. бесплатно, в т.ч. для коммерческого использования. Обе программы кросплатформенные, есть дистрибутивы под Windows, Linux и MacOS.

## Критерии сравнения аналогов:
### Практичность 
Набор атрибутов, относящихся к объему работ, требуемых для использования и индивидуальной оценки такого использования определенным или предполагаемым кругом пользователей.
Решает ли программа поставленную задачу
### Стоимость
Метод оценки стоимости программ для ЭВМ, написанных на одном из алгоритмических языков высокого уровня (Фортран, Ада и Си++), основан на сравнении оцениваемой программы с некоторой средней программой, стоимость которой определяется известными способами на основе цен, сложившихся в настоящее время на рынке программных продуктов.
### Классификация сбоев и отказов
Основным принципом классификации сбоев и отказов в программах при отсутствии их физического разрушения является разделение по временному показателю длительности восстановления после любого искажения программ, данных или вычислительного процесса, регистрируемого как нарушение работоспособности. 

## Таблица сравнения по критериям 
_ | Практичность |Стоимость|Классификация сбоев и отказов
------------ | -------------|---------------|--------------------
|Intuwiz G-code Generator|Программа предлагает вручную составлять объект из фигур. Незарегистрированная версия не позволяет сохранять код, а также показывает только первые 35 строк кода.|1990 рублей|В ходе тестирования отказов не выявлено.
Генерация G-кода, из текста, рисунка, и файлов PLT, DXF|Построение кода по рисунку не решает в полной мере поставленной задачи.|Бесплатная.|Программа содержит ряд ошибок.
Gcodetools - CAM расширение для Incscape|Построение кода по рисунку не решает в полной мере поставленной задачи.|Бесплатная.|Программа содержит ряд ошибок.

## Выводы по итогам сравнения:
В ходе поисков программы, позволяющей выполнить поставленную задачу было проанализировано программное обеспечение (ПО) схожего функционала. В результате поисков необходимое ПО найдено не было и было принято решение написать программу самостоятельно.

## Метод решения
Необходимо написать программу, которая построит ¬G-code по 3D модели. Ввиду отсутствия готовой программы было принято решение написать данную программу используя уже реализованные алгоритмы и методы анализа фигур произвольной формы. 
В результате должна получиться программа позволяющая фрезеровать детали за меньшее количество времени, за чет того, что часть пути будет построено при помощи кривых, а не отрезков. 
В качестве примера можно привести фрезерование контура круга. Если фрезеровать круг двумя кривыми, станку потребуется разгоняться до скорости подачи всего два раза и столько же раз тормозить. 

**Скорость подачи** – это путь точки режущего лезвия инструмента относительно заготовки в направлении главного движения в единицу времени. Скорость подачи измеряется в метрах в минуту (м/мин).
Если фрезеровать круг отрезками появляется погрешность, которая зависит от количества отрезков. Чем меньше отрезков, тем больше погрешность. Чтобы уменьшить погрешность необходимо большое количество отрезков, а с этим возрастет количество разгонов и торможений моторов, направляющих фрезер. Все это приводит к увеличению кода и времени на реализацию детали. 

**Деталь** — изделие, изготовляемое из однородного материала без применения сборочных операций.

## Описание метода решения
В качестве входных данных программа получает 3D модель.
3D модель представляет собой основные элементы - точки (вершины) расположенные в трехмерном пространстве и чаще всего являющиеся частью замкнутого многоугольника или полигона. Объединяются они посредством линий, соединяющих две таких точки, которые называются гранями. Грани не являются самостоятельными объектами в трехмерном моделировании и выступают в роли границ многогранников. Полигоны или плоские многоугольные фигуры – один из элементов трехмерной модели, из объединенного числа которых состоит поверхность 3d фигуры. Большинство приложений и программ для 3d моделирования, а также редакторов для работы с трехмерной графикой оперируют треугольниками и четырехугольниками.
В ходе изучения данной проблемы было предложено решение разделить 3D модель на горизонтальные слои с расстоянием между ними равным значению, позволяющему фрезе заглубляться без риска порчи станка. В случае несоблюдения этого условия есть риск поломки фрезы и порчи заготовки.
Заготовка — промежуточный продукт производства, предназначенный для дальнейшей переработки.
Фреза? — инструмент с одним или несколькими режущими лезвиями (зубьями) для фрезерования.
Фрезерование (фрезерная обработка) — это процесс механической обработки, при котором режущий инструмент (фреза) совершает вращательное движение (со скоростью V), а обрабатываемая заготовка — поступательное (со скоростью подачи S).
Полученные произвольной формы фигуры будут преобразованы в контуры с последующим фрезерованием поверхности внутри них. Контуры планируется представлять в виде набора линий и кривых Безье[1].  
Кривая Безье — это полином третьего порядка. Как и все полиномы третьего порядка, кривая Безье уникально определяется четырьмя точками[3]. 
Плоская алгебраическая кривая — это множество точек с координатами x, y, задаваемое множество решений уравнения f(x, y) = 0, где f — многочлен от двух переменных с коэффициентами в поле F.
Поле в общей алгебре — множество, для элементов которого определены операции сложения, вычитания, умножения и деления (кроме деления на нуль), причём свойства этих операций близки к свойствам обычных числовых операций.
Далее необходимо провести анализ, возможности механической обработки ВКО в соответствии с заданными параметрами, так как возможны случаи, когда форма фигуры не позволит фрезе попасть в отдельные ее участки.  Далее внутри замкнутых контуров необходимо построить траекторию фрезерования кармана. 
Затем необходимо разделить 3D модель на вертикальные слои и применить анализ, описанный выше.
Расслоение модели на вертикальные и горизонтальные слои позволит повысить качество выполнения детали, так как если выточить деталь используя только горизонтальные срезы, плоскости будут состоять из ступеней.  Это допустимо для детали грубой обработки, но никак не в качестве конечного результата.
Так же планируется варьировать скорость движения фрезы на отдельных участках, во избежание перегрева фрезы и порчи заготовки.
Заготовка — промежуточный продукт металлургического производства, предназначенный для дальнейшей металлургической переработки. 
Данный подход позволит фрезеровать детали из различных материалов (пластик, дерево, металл и так далее) без риска порчи станка и заготовки.

## Выводы:
В ходе разработки программного обеспечения была написана программа, которая на текущий момент решает часть задач, а именно:
1.	делить 3D модель на слои
2.	строить G-code простых фигур и фрезерует внутри них карманы
на текущий момент осталось реализовать оставшиеся задачи, такие как:
1.	построить траекторию движения фрезы при помощи кусочно-линейной и круговой интерполяции для произвольной фигуры
2.	обработку карманов внутри произвольных фигур
 планируется в первом квартале 2018 года, а также провести тесты необходимые корректировки в ходе доработки алгоритма. Готовый продукт планируется предоставить заказчику в конце второго квартала 2018 года.


## Источники
Нумерованный список источников 
1.	http://www.intuwiz.ru/progs/g-code-generator.html#.WjJTdTdx1QI
2.	http://www.cnc-club.ru/forum/viewtopic.php?f=16&t=12096#phpbb3bbcodes_spoiler
3.	http://www.cnc-club.ru/forum/viewtopic.php?t=34
4.	http://sernam.ru/book_mm3d.php?id=92
5.	https://www.google.ru/url?sa=t&rct=j&q=&esrc=s&source=web&cd=7&ved=0ahUKEwjJ0q2x4InYAhXGFJoKHSKxBToQFghNMAY&url=http%3A%2F%2Ftechnomag.bmstu.ru%2Ffile%2F801468.html%3F__s%3D1&usg=AOvVaw3XI91qOVPRZUYT7OVlprvy
6.	Programming Microsoft Windows with C# Книга, Чарльз Петцольд