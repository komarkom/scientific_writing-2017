# Разработка приложения для определения российских номеров машин

## Аннотация
Данная статья посвящена решению проблемы поиска российских номеров машин. В статье рассмотрены существующие решения, показаны их достоинства и недостатки. На основе их исследования было предложено новое решение, которое позволяет устранить недостатки существующих приложений и библиотек. Был описан новый алгоритм для поиска номеров. Разработано приложение, позволяющее пользователю определять номера российских машин без ошибок. Данное приложение использует openCV и android vision для поиска номерных знаков и определения текста. Для поиска номера в тексте проводится pattern matching.

## Введение
Определение номеров машин является неотъемлимой частью любых сервисов, связанных с автомобилями. Поиск номеров упрощает введение номера автомобиля в систему и позволяет автоматизировать его. Также решение данной задачи необходимо для обнаружения нарушений правил парковки.
Целью данной работы было создание приложения, которое может определять российские номера.
Для достижения данной цели необходимо выполнить следующие задачи:
* Изучение предметной области
* Исследование существующих технологий для решения проблемы
* Сравнение с существующими аналогами
* Проектирование и разработка приложения
* Тестирование и доработка

## Обзор предметной области
### Openalpr-android
Automatic plate recogcnition for android это библиотека под android для поиска номеров машин. С её помощью удалось сделать приложение для распознавания американских номеров, однако русские номера данная библиотека не определяет.
### Google vision optical character recogcnition
Это часть Google Cloud Vision API, предназначенная для определения текста. Распознаёт практически любой текст. Данная библиотека не нацелена на распознавание номеров машин, однако распознаёт их текст, выдавая при этом несколько вариантов текста. Можно использовать с любого устройства, однако требуется подключение к интернету и Google API services.
### Google android vision
Это часть Google text recognition api для определения текста. Данная библиотека позвоялет распознавать текст без подключения к google api services и интернету. Однако она распознаёт весь текст, который попал в кадр. Не рапознаёт конкретно номера и русские буквы. Может распознать номер машины как латыницу, выдавая при этом несколько вариантов текста.  
### UIT-ANPR
Библиотека для распознавания номеров автомобилей оффлайн на android-смартфонах. Распознает американские и европейские номера, однако часто допускает ошибки. Не распознает русские номера.

### Критерии для сравнения
* Точность распознавания - распознает ли библиотека номера без ошибок;
* Распознавание российских номеров - умеет ли библиотека распознавать русские номера;
* Распознавание номеров оффлайн - нужно ли подключение к интернету для библиотеки; 
* Распознавание только номеров машин - распознаёт ли библиотека только номера или все текстовые объекты в кадре;

### Таблица сравнения по критериям
Критерий\Аналог | Openalpr-android | Google vision OCR | Google android vision | UIT-ANPR
------------ | ------------- | ------------- | ------------- | ------------- 
Точность распознавания | + | - | - | -
Распознавание российских номеров | - | - | - | -
Распознавание номеров оффлайн | + | - | + | +
Распознавание только номеров машин | + | - | - | +
## Выводы по итогам сравнения
В соответствии с приведёнными выше аналогами можно сделать вывод, что основная проблема существующих решений - немозможность распознавания российских номеров. Также многие библиотеки распознают весь текст, что приводит к потере точности и безошибочности распознавания. Для некоторых библиотек требуется интернет-подключение.

## Выбор метода решения 
В результате сравнения существующих аналогов были выявлены их основные минусы: библиотеки не нацелены на определение именно номеров машин и ни одна из них не может найти русский номер машины.

Поэтому цель работы - создать приложение которое может определять русские номера машин, при этом не распознавая сторонний текст как номер.

Решение должно также обладать следующими свойствами:
* Удобный и понятный интерфейс. Даже новый пользователь приложения должен сразу понять что именно нужно сделать, чтобы определить номер автомобиля. 
* Отызвчивый интерфейс. Приложение должно сообщать пользователю о своём текущем состоянии: номер определён, номер не определён, номер определяется.
* Возможность работы без интернета. Приложение должно распознавать номера без подключения к интернету.
* Возможность работы без Google Services API. Так как ее на всех устройствах есть Google Services и подключение к интернету.
* Определение специфичных номеров. Приложение должно уметь определять номера особых автомобилей: мотоциклов, грузовых машин и т.д.  

## Описание метода решения

### Технологии
Для решения поставленной задачи были использованы следующие технологии:
*OpenCV[1] - для поиска номерного знака в кадре с автомобилем.
*Google android vision - для непосредственного поиска текста в кадре с номерным знаком.
*Android SDK - для разработки приложения под android.
*Android Camera API - для захвата изображения c камеры.
### Алгоритм определения номера автомобиля
Для того, чтобы избавиться от проблемы обнаружения различных текстовых объектов как номеров машин, процесс нахождения номера был разбит на два шага: определение номерного знака и определение номера на номерном знаке.
Данный алгоритм позволяет избавиться от проблемы обнаружения текстовых объектов(вывесок магазинов, рекламных щитов и т.д.) как номера машины, так как сначала идёт нахождение номерного знака в кадре. Если номерной знак найден, то переходим к следующему шагу, иначе возвращается ошибка. Затем в кадре с номерным знаком при помощи android vision находится текст и из предложенных вариантов выбирается тот, который совпадает с маской номера. Если среди вариантов совпадений нет, то возвращается ошибка.
Общий алгоритм определения номера выглядит так:
1. Нахождение номерного знака в кадре.
2. Распознавание текста в кадре с найденным номерным знаком.
3. Pattern matching с масками номеров.
#### Алгоритм поиска номерного знака в кадре.
Для обнаружения номерных знаков был использован метод Виолы-Джонса[2], реализация которого входит в состав библиотеки OpenCV. Основные принципы метода:
* для быстрого вычисления объектов используются изображения в интегральном представлении;
* для поиска нужного объекта(номерного знака в данной задаче) используются признаки Хаара. Признаки Хаара позволяют анализировать область на предмет наличия в ней характерных для номера отношений, точек или градиентов;
* для выбора наиболее подходящих признаков для искомого объекта на данной части изображения используется бустинг;
* все признаки поступают на вход классификатора, который даёт результат «верно» либо «ложь»;
* используются каскады признаков для быстрого отбрасывания окон, где не найден номерной знак.
#### Алгоритм поиска текста в кадре с номерным знаком
Для обнаружения текста в кадре с номерным знакомы используется библиотека google android vision. На вход подаётся кадр с текстом, результатом работы библиотеки является список строк с предполагаемым текстом. Данная библиотека не может определить именно номер целиком, но среди полученных вариантов всегда есть верный. Так как для российских номеров используются буквы, которые пишутся одинаково с латиницей, точность полученных букв высока.
#### Алоритм поиска номера из полученного массива текста
Для поиска номера полученный в полученном тексте при помощи pattern matching по заготовленным маскам идёт поиск подходящей комбинации символов. 

## Заключение

Целью данной работы было создать приложение для определения российского номера машины.

На основании исследования существующих подходов к решению поставленной проблемы и их анализа было разработано приложение для определения номеров машин.
В разработанном приложении за счёт применения нового алгоритма поиска номера были устранены основные недостатки существующих аналогов: отсутствие определения российских номеров и определение стороннего текста вместо определения номера машины.

К недостаткам разработанного приложения можно отнести: трудность определения загрязнённого номера машины и невозможность определения номеров машин других стран.

Разработанное приложение будет частью более крупного по определнию нарушениий правил парковки автомобилей.

## Источники

Источники:
[1] Gary Bradski, Adrian Kaehler "Learning OpenCV: Computer Vision with the OpenCV Library", September 2008. - 566 с. https://www.ozon.ru/context/detail/id/5415514/
[2] "Viola–Jones object detection framework". URL:[https://en.wikipedia.org/wiki/Viola–Jones_object_detection_framework](https://en.wikipedia.org/wiki/Viola–Jones_object_detection_framework)