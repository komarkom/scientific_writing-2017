# Создание веб-сервиса для поиска музыки по подобию

## Аннотация

В современном мире существует множество сервисов, осуществляющих поиск новой музыки для прослушивания. Большинство таких сервисов используют коллаборативную фильтрацию для выбора рекомендуемых композиций, либо дорогостоящие и затратные по времени решения, основанные на нейронных сетях или фильтрации на основе контента. В данной работе представлен проект сервиса с использованием фильтрации на основе контента, в котором пользователю предлагается самостоятельно осуществлять регулировку параметров для поиска музыки, при этом предполагается, что полученный механизм поиска будет работать быстрее и дешевле, чем существующие аналоги.

### Введение

Текущие рекомендательные системы для поиска музыки, использующие коллаборативную фильтрацию, значительно превосходят по своей распространенности рекомендательные системы на основе контента [13], и при этом не предоставляют нужного пользователю результата. В существующих решениях пользователь не может самостоятельно отрегулировать параметры, учитываемые в поиске похожей музыки, при таком подходе остаются основные недостатки коллаборативной фильтрации - проблема холодного старта, разреженности данных и синонимии [10].
Целью работы является разработка инструмента, имеющего возможность выполнять регулировку параметров для поиска подобной музыки с использованием фильтрации на основе контента, таким образом улучшив качество ответов по сравнению с аналогами, а также снизив временную и материальную стоимость обработки новых композиций.

## Сравнение аналогов

Для сравнения были рассмотрены крупнейшие сервисы по прослушиваю музыки, в рамках которых присутствует функция поиска похожей музыки.

### Pandora Radio

Представляет собой службу потокового воспроизведения музыки и основана на рекомендательной системе Music Genome Project. [1] В базе данных Pandora Radio находится более миллиона композиций с около 400 характеристиками к каждой. [2][3] Пользователь выбирает музыкального исполнителя, после чего система ищет похожие композиции. Используя функции "нравится" или "не нравится", слушатель часто может настроить радиостанцию по своему вкусу, однако, вынужден мириться с определёнными ограничениями в случае использования бесплатной подписки. Сервис был доступен до 31 июля 2017 года в США, Австралии и Новой Зеландии, но на текущий момент доступен только в США. [4]

### Spotify

Служба потокового аудио, предоставляющая возможность бесплатно слушать музыку, составлять плейлисты, искать рекомендации. Музыку можно искать по нескольким параметрам, в том числе по жанру, исполнителю или по лейблу звукозаписи. Рекомендации предоставляются гибридной рекомендательной системой на основе метода ансамбля с использованием свёрточных нейронных сетей. [5]

### VK.com

Крупнейшая социальная сеть в Европе. [6] Рекомендации в разделе "Музыка" предоставляются на основе коллаборативной фильтрации с учётом персонализации результатов. [7]

## Критерии сравнения аналогов

### Используемый тип рекомендательной системы

При использовании рекомендательной системы с фильтрацией на основе содержания сервис предоставляет пользователю результат, основываясь на содержимом объектов (музыки). При использовании рекомендательной системы на основе коллаборативной фильтрации результат формируется исключительно на основе оценок других пользователей. У обоих подходов есть недостатки, описанные в [8] и многих других источниках. В исследовании [9] было показано, что для некоторых случаев гибридные рекомендательные системы являются более подходящими по сравнению с остальными.

### Размер музыкальной библиотеки

Количество треков, информация о которых имеется в системе. В связи с проблемой холодного старта для рекомендательных систем, основанных на коллаборативной фильтрации как сказано в [10], а также подобной проблеме для гибридных рекомендательных система, описанной в [11], размер библиотеки является существенной характеристикой системы.

### Персонализация поиска

Возможность для каждого отдельно взятого пользователя или запроса определения результата работы системы с учётом истории действий в сервисе, либо без их учёта. Так, успех компаний Netflix и Surfingbird, использующих гибридные рекомендательные системы [8], совместно с исследованием [12], показывают, что использование истории пользователя и персонализация выдачи поисковых результатов повышает оценки качества работы сервиса.

Критерий\Аналог                      | Pandora radio                   | Spotify        | VK.com                    
------------------------------------ | ------------------------------- | -------------- | --------------------------
Тип рекомендательной системы         | Фильтрация на основе содержания | Гибридная      | Коллаборативная фильтрация
Размер библиотеки музыки             | > 1 миллиона                    | > 30 миллионов | не известно
Персонализация поиска                | Есть                            | Есть           | Есть
Стоимость обработки новых композиций | Высокая                         | Низкая         | Низкая

*<center>Таблица 1 - Сравнение аналогов по критериям</center>*

## Выводы по итогам сравнения

Популярнейшие сервисы предоставляют возможность использования рекомендаций, предоставленных рекомендательными системами разных видов, однако не дают пользователю самостоятельно отрегулировать какие параметры для него являются значимыми в поиске новой музыки. Ближайший по функциональности аналог Pandora radio использует Music Genome Project, в рамках которого временная и материальная стоимость обработки новых композиций находится на высоком уровне [26].

## Выбор метода решения

При обзоре аналогов были выявлены основные недостатки в имеющихся решениях, которые предлагается устранить либо нивелировать для удовлетворения потребностей пользователей в новом веб-сервисе:
* Нужно позволить пользователю самостоятельно выбирать параметры поиска похожих композиций для улучшения удобства использования [12];
* Обеспечить стандартный набор параметров, полученных другими пользователями, на состояние которых не обязательно оказывать влияние для получения качественных рекомендаций;
* Обеспечить поиск как по библиотеке музыкальных композиций отдельного пользователя, так и по общей, предоставив пользователю большую кастомизацию поиска, поскольку в [13] не было найдено ни одного сервиса с подобными функциями, однако потребность пользователей в таком сервисе есть [14] [15];
* Использовать в первую очередь фильтрацию на основе содержания, но автоматизировать рассчёт параметров музыкальной композиции для снижения материальных и временных затрат, поскольку ввиду [16] прибегая к помощи человека они значительно увеличивают время обработки каждой композиции, и более того - увеличивают вероятность ошибки не объективности результатов.

## Описание метода решения

### Общий обзор метода решения

В конечном решении нужно создать легкомасштабируемый надёжный веб-сервис со следующими функциональными частями:
* Регистрация и авторизация пользователя;
* Поиск музыки, похожей на конкретную композицию, выбранную пользователем;
* Расширенный поиск музыки, в параметрах которого пользователь может задать перечисленные ниже, но не ограничиваясь лишь этим списком, параметры:
  1. Жанр (поп, рок, академическая музыка и т.д.);
  2. Тональность (до мажор, фа-диез мажор, соль минор и т.д.) [17], а также связанные с ней характеристики, описанные в [18];
  3. Темп музыки (40-48, 44-52, 63-80 и т.д.) [19];
  4. Тип лада (модальная гармония, тональная гармония);
  5. Тип музыкального стиля (например, "гармония барокко" [20]);
  6. Главная нота (аккорд);
  7. Наличие вокала.
* Аналогичные варианты поиска для отдельных частей музыкальных композиций;
* Возможность загружать собственные композиции;
* Ограничивать поиск похожей музыки среди загруженной своей библиотеки музыки.
Исследования [21], [22] показывают, что значения времени загрузки страницы сервиса более 1 секунды значительно уменьшают конверсию на сайтах, однако на домашней конфигурации компьютера (Intel B950, 2.1 GHz) рассчёт одного лишь темпа с помощью библотеки Librosa [23] композиции длиной 5 минут занимает более 20 секунд, что является неприемлемым. В связи с этим, требуется организовать асинхронную очередь рассчёта параметров композиции для отложенного получения результатов.

### Особенности метода решения

Согласно рекомендации сообщества DigitalOcean [24] был сделан выбор в пользу следующего стека технологий для создаваемого веб-сервиса: Python, Django, Librosa, PostgreSQL, Gunicorn (+Nginx). Неподсредственное взаимодействие между компонентами этого стека также описаны в [25].
Общая архитектура системы (см. Рис. 1) условно разделяет процесс обработки аудио на 4 этапа:
1. Пользователь загружает аудио-файл на сервер (PreLoadedAudio), который делится на равные временные промежутки, которые помещаются в очередь на обработку;
2. Из задач в очереди формируются запросы на обработку (ProcessQuery) для отдельных потоков обработки (Processor), который контроллируется менеджером потоков обработки (ThreadManager);
3. Запросы обрабатываются с помощью библиотеки Librosa;
4. Информация об обработанных аудио-файлах и информация о полученных характеристиках сохраняется в базу данных;
5. При поисковом запросе пользователем происходит выборка из базы данных по заданным пользоватем параметрам.

![Рис. 1 - Общая архитектура решения. Пример с BPM (темп).](https://pp.userapi.com/c840622/v840622299/33a51/yZvIzKfzg2c.jpg)

Рис. 1 - Общая архитектура решения. Пример с BPM (темп).

## Выводы

В данной работе была описана концепция и общее архитектурное решение сервиса для поиска музыки по подобию. При этому в силу субъетивности понятия "подобная музыка" было предложено ввести в сервис функционал расширенного поиска, предлагающий самостоятельно конкретизировать это понятие для пользователя.
В предложенном подходе при использовании фильтрации лишь на основе контента без значительных отзывов пользователей вероятно проявление проблемы "холодного старта". Однако, учитывая результаты работы пользователей, в дальнейшем предполагается установить значения поисковой системы так, чтобы удовлетворить требования большинства.
На данный момент получен сервис для простейшего расчёта темпа музыки. Дальнейшие исследования в первую очередь включают в себя расширение функционала по добавлению других характеристик, а далее - их интеграция в расширенный параметризованный поиск.

## Источники

1. Pandora Radio. 13.12.2017, URL: https://en.wikipedia.org/wiki/Pandora_Radio
2. The Best Music Services Compared. 02.01.2014, URL: http://www.techlicious.com/guide/best-music-service-best-for-you/
3. About Pandora. 29.12.2014, URL: http://www.pandora.com/about
4. Pandora no longer available in Australia... 12.09.2017, URL: http://help.pandora.com/customer/portal/articles/2830912
5. Ever Wonder How Spotify Discover Weekly Works? Data Science. 14.12.2017, URL: http://blog.galvanize.com/spotify-discover-weekly-data-science/
6. Годовой отчёт Mail.Ru Group Limited. 28.04.2017, URL: https://corp.mail.ru/ru/mobile/releases/9967/
7. Всё об аудиозаписях "Вконтакте". 14.12.2017, URL: https://vk.com/page-2158488_47218044
8. Recommender system. 13.12.2017, URL: https://en.wikipedia.org/wiki/Recommender_system
9. Adomavicius, G.; Tuzhilin, A. (June 2005). "Toward the Next Generation of Recommender Systems: A Survey of the State-of-the-Art and Possible Extensions". IEEE Transactions on Knowledge and Data Engineering. 17 (6): 734–749. doi:10.1109/TKDE.2005.99
10. Коллаборативная фильтрация. 13.12.2017, URL: https://ru.wikipedia.org/wiki/Коллаборативная_фильтрация
11. Melville P., Mooney R., Nagarajan R. Content-Boosted Collaborative Filtering for Improved Recommendations // University of Texas, USA : Материалы конф. / AAAI-02, Austin, TX, USA, 2002. — 2002. — P. 187-192.
12. Wang, Ying; Tan, Chee-Wee; and clemmensen, torkil, "DO YOU GET BETTER USER EXPERIENCES WHEN YOU CUSTOMIZE YOUR SMARTPHONE?: AN EXPERIMENT WITH OBJECT AND BEHAVIOR-BASED BELIEFS AND ATTITUDES" (2016). Research Papers. Paper 113. http://aisel.aisnet.org/ecis2016_rp/113
13. 20 fantastic ways to find new music that you like, 17.03.2009, URL: http://inspiredm.com/20-fantastic-ways-to-find-new-music-that-you-like-no-lastfm-pandora-inside/
14. similar music - Google Trends. 16.12.2017, URL: https://trends.google.ru/trends/explore?date=today%205-y&q=similar%20music
15. [Discover] "Find Similar Songs" Option - The Spotify Community. 16.12.2017, URL: https://community.spotify.com/t5/Live-Ideas/Discover-quot-Find-Similar-Songs-quot-Option/idi-p/1580814
16. Ike, Elephant (February 2006). "Tiny Mix Tapes: Tim Westergren Interview". 30.05.2013, URL: https://www.tinymixtapes.com/features/tim-westergren-music-genome-project-founder
17. И. Дубовский, С. Евсеев, И. Способин, В. Соколов. Учебник гармонии. М.: Музыка, 2007
18. Тональность - Википедия. 16.12.2017, URL: https://ru.wikipedia.org/wiki/Тональность
19. Мальтер Л. Таблицы по инструментоведению. — М., 1964.
20. Музыка эпохи барокко — Википедия. 16.12.2017, URL: https://ru.wikipedia.org/wiki/Музыка_эпохи_барокко
21. Marissa Mayer. In Search of... A better, faster, stronger Web. - Velocity. Web performance and operations conference. 22-24 June 2009
22. Why Web Performance Matters: Is Your Site Driving Customers Away? 2010, URL: http://www.mcrinc.com/Documents/Newsletters/201110_why_web_performance_matters.pdf
23. Librosa. 16.12.2017, URL: https://librosa.github.io/
24. Popular tutorials | Digital Ocean. 16.12.2017, URL: https://www.digitalocean.com/community/tutorials?q=django&primary_filter=popular
25. How To Set Up Django with Postgres, Nginx, and Gunicorn on Ubuntu 16.04 | DigitalOcean. 16.12.2017, URL: https://www.digitalocean.com/community/tutorials/how-to-set-up-django-with-postgres-nginx-and-gunicorn-on-ubuntu-16-04
26. Tim Westergren (Music Genome Project Founder) | Interview | Tiny Mix Tapes. 02.02.2006, URL: https://www.tinymixtapes.com/features/tim-westergren-music-genome-project-founder
